from fastapi import FastAPI
from pydantic import BaseModel
from openai import OpenAI
from fastapi.middleware.cors import CORSMiddleware

CUSTOMER_SERVICE = "๐ +967 784784118 \n +967 775436959 \n +967 777335742"
'''
RULE_BASED_ANSWERS = {
    
    # ุชุญูุฉ
    "ูุฑุญุจุง": "ุฃููุงู ูุณููุงู ุจู ูู TechZone ุชูู ุฒูู. ููู ุฃูุฏุฑ ุฃุณุงุนุฏูุ",
    "ุงูุณูุงู": "ูุฑุญุจูุง ุจู ูู TechZone ุชูู ุฒูู. ููู ุฃูุฏุฑ ุฃุณุงุนุฏูุ",
    "ุงููุง": "ุฃููุงู ุจู ูู TechZone ุชูู ุฒูู. ููู ุฃูุฏุฑ ุฃุณุงุนุฏูุ",

    # ุงูุดุญู
    "ูุชู ูุทูุน ุงูุดุญู": "ูุชู ุดุญู ุงูุทูุจ ุฎูุงู 24 ุฅูู 48 ุณุงุนุฉ ุนูู.",
    "ูุชู ุณูุชู ุดุญู": "ูุชู ุดุญู ุงูุทูุจ ุฎูุงู 24 ุฅูู 48 ุณุงุนุฉ ุนูู.",
    "ููุด ุงูุทูุจ ูุชุฃุฎุฑ": f"ูุนุชุฐุฑ ุนู ุงูุชุฃุฎูุฑ. ุฒูุฏูุง ุจุฑูู ุงูุทูุจ ุฃู ุชูุงุตู ูุนูุง: {CUSTOMER_SERVICE}",
    "ููุด ุงูุดุญู ูุชุฃุฎุฑ": f"ูุนุชุฐุฑ ุนู ุงูุชุฃุฎูุฑ. ุฒูุฏูุง ุจุฑูู ุงูุทูุจ ุฃู ุชูุงุตู ูุนูุง: {CUSTOMER_SERVICE}",

    # ุฎุฏูุฉ ุงูุนููุงุก
    "ุฑูู ุฎุฏูุฉ ุงูุนููุงุก": f"ุฑูู ุฎุฏูุฉ ุงูุนููุงุก:\n{CUSTOMER_SERVICE}",
    "ุงููู ุฎุฏูุฉ ุงูุนููุงุก": f"ุชูุงุตู ูุนูุง ุนุจุฑ:\n{CUSTOMER_SERVICE}",
    "ุงุจุบู ุงููู ุฎุฏูุฉ ุงูุนููุงุก": f"ุชูุงุตู ูุนูุง ุนุจุฑ:\n{CUSTOMER_SERVICE}",
    "ุนูุฏู ูุดููุฉ": f"ูุถุญ ุงููุดููุฉ ุจุงุฎุชุตุงุฑุ ุฃู ุชูุงุตู ูุนูุง: {CUSTOMER_SERVICE}",
}

def rule_based_reply(message: str):
    msg = (message or "").strip().lower()
    for key, reply in RULE_BASED_ANSWERS.items():
        if key in msg:
            return reply
    return None
'''



INTENTS = {
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐๏ธ ุงูุชุญูุงุช ูุงูุชุฑุญูุจ
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "greeting": {
        "keywords": ["ูุฑุญุจุง", "ุงูุณูุงู", "ุงููุง", "ููุง", "ูุงู", "ุตุจุงุญ", "ูุณุงุก", "ูููู", "ููู ุญุงูู", "ุดุฎุจุงุฑู"],
        "answer": "ุฃููุงู ูุณููุงู ุจู ูู TechZone ุชูู ุฒูู! ๐\nุฃูุง ูุณุงุนุฏู ุงูุฐููุ ููู ูููููู ุฎุฏูุชู ุงููููุ"
    },
    "thanks": {
        "keywords": ["ุดูุฑุง", "ูุดููุฑ", "ูุนุทูู ุงูุนุงููุฉ", "ุงููู ูุนุงููู", "ููุชุงุฒ", "ุชูุงู"],
        "answer": "ุงูุนูู! ูุณุนุฏ ุจุฎุฏูุชู ุฏุงุฆููุง ูู TechZone ุชูู ุฒูู. ูู ููุงู ุดูุก ุขุฎุฑ ูููููู ูุณุงุนุฏุชู ูููุ"
    },
    "goodbye": {
        "keywords": ["ุจุงู", "ูุน ุงูุณูุงูุฉ", "ุงูู ุงูููุงุก", "ูุฏุงุนุง", "ููุง ุจุงู"],
        "answer": "ุดูุฑูุง ูุชูุงุตูู ูุน TechZone ุชูู ุฒูู! ูุชููู ูู ููููุง ุณุนูุฏูุงุ ููุชุทูุน ูุฎุฏูุชู ูุฌุฏุฏูุง. ๐"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ ุงูุดุญู ูุงูุชูุตูู
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "shipping_methods": {
        "keywords": ["ุทุฑู ุงูุดุญู", "ุดุฑูุงุช ุงูุดุญู", "ููู ุชุดุญูู", "ุงูุดุญู", "ุงูุชูุตูู", "ููุตู", "ุดุญู"],
        "answer": """๐ ุทุฑู ุงูุดุญู ุงููุชููุฑุฉ ูู TechZone:

1๏ธโฃ ุฏุงุฎู ุตูุนุงุก: ุชูุตูู ุณุฑูุน ุฎูุงู 24 ุณุงุนุฉ ุนุจุฑ ููุฏูุจููุง ๐ต
2๏ธโฃ ุงููุญุงูุธุงุช ุงูุฑุฆูุณูุฉ: ุนุจุฑ ุดุฑูุฉ "ุงููููุฒ" ุฃู "ุงูุฅุฎูุฉ" (2-4 ุฃูุงู) ๐
3๏ธโฃ ุงูููุงุทู ุงููุงุฆูุฉ: ุนุจุฑ ููุงุชุจ ุงูููู ุงูุฌูุงุนู (4-7 ุฃูุงู) ๐

ููููู ุงุฎุชูุงุฑ ุงูุทุฑููุฉ ุงูุฃูุณุจ ูู ูู ุตูุญุฉ ุฅุชูุงู ุงูุทูุจ!"""
    },
    "shipping_time": {
        "keywords": ["ูุชู ููุตู", "ูุชู ุงูุชูุตูู", "ูู ููู", "ูุชู ูุตู", "ููุช ุงูุดุญู", "ูุฏุฉ ุงูุดุญู", "ูุชู ููุดุญู", "ูุทูุน ุงูุดุญู", "ููุดุญู"],
        "answer": "โฑ๏ธ ูุฏุฉ ุงูุชูุตูู ุงููุชููุนุฉ:\nโข ุตูุนุงุก: ุฎูุงู 24 ุณุงุนุฉ\nโข ุงููุฏู ุงูุฑุฆูุณูุฉ: 2-4 ุฃูุงู ุนูู\nโข ุจุงูู ุงููุญุงูุธุงุช: 4-7 ุฃูุงู ุนูู\n\nูุชู ุชุฌููุฒ ุงูุทูุจ ูุชุณูููู ูุดุฑูุฉ ุงูุดุญู ุฎูุงู 24 ุณุงุนุฉ ูู ุชุฃููุฏู."
    },
    "shipping_cost": {
        "keywords": ["ุชูููุฉ ุงูุดุญู", "ุณุนุฑ ุงูุชูุตูู", "ูู ุงูุดุญู", "ุฑุณูู ุงูุชูุตูู", "ุงูุดุญู ูุฌุงูู", "ุชูุตูู ูุฌุงูู"],
        "answer": "๐ฆ ุชูููุฉ ุงูุดุญู:\nโข ุฏุงุฎู ุตูุนุงุก: 500 ุฑูุงู\nโข ุงููุญุงูุธุงุช ุงูุฃุฎุฑู: 800-1500 ุฑูุงู\n๐ ุดุญู ูุฌุงูู ููุทูุจุงุช ููู 50,000 ุฑูุงู!"
    },
    "shipping_delay": {
        "keywords": ["ูุชุฃุฎุฑ", "ุชุฃุฎุฑ", "ุชุงุฎุฑ", "ููุด ูุง ูุตู", "ุงูุทูุจ ูุชุงุฎุฑ", "ุงูู ุทูุจู", "ููู ุทูุจู", "ููุด"],
        "answer": f"ูุนุชุฐุฑ ุนู ุฃู ุชุฃุฎูุฑ! ๐\nูุฑุฌู ุชุฒููุฏูุง ุจุฑูู ุงูุทูุจ ููุชุงุจุนุฉ ุญุงูุชู.\nุฃู ุชูุงุตู ูุจุงุดุฑุฉ ูุน ุฎุฏูุฉ ุงูุนููุงุก:\n{CUSTOMER_SERVICE}"
    },
    "shipping_areas": {
        "keywords": ["ููุงุทู ุงูุชูุตูู", "ุงู ููุงุทู", "ุชูุตููู ูู", "ูู ุชูุตููู", "ุชุบุทูุฉ ุงูุดุญู"],
        "answer": f"๐บ๏ธ ููุตู ูุฌููุน ูุญุงูุธุงุช ุงูููู!\nุงููุฏู ุงูุฑุฆูุณูุฉ: ุตูุนุงุกุ ุนุฏูุ ุชุนุฒุ ุงูุญุฏูุฏุฉุ ุฅุจุ ุฐูุงุฑ\nููููุงุทู ุงููุงุฆูุฉุ ุชูุงุตู ูุนูุง:\n{CUSTOMER_SERVICE}"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ฆ ุชุชุจุน ุงูุทูุจ
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "track_order": {
        "keywords": ["ุชุชุจุน", "ุงุชุชุจุน", "ููู ูุตู", "ุญุงูุฉ ุงูุทูุจ", "ุฑูู ุงูุชุชุจุน", "ุชุงุจุน ุทูุจู"],
        "answer": "๐ ูุชุชุจุน ุทูุจู:\n1๏ธโฃ ุงุฏุฎู ุนูู ุญุณุงุจู ูู ุงููููุน\n2๏ธโฃ ุงุฐูุจ ุฅูู 'ุทูุจุงุชู'\n3๏ธโฃ ุงุถุบุท ุนูู ุฑูู ุงูุทูุจ ููุดุงูุฏุฉ ุงูุชูุงุตูู\n\nุฃู ุฃุฑุณู ูู ุฑูู ุงูุทูุจ ูุณุฃุณุงุนุฏู!"
    },
    "order_status": {
        "keywords": ["ุญุงูุฉ ุทูุจู", "ูุตู ุงูุทูุจ", "ุดุญูุชูุง", "ุงุฑุณูุชูุง", "ููุฏ ุงูุชูููุฐ"],
        "answer": "๐ ููุนุฑูุฉ ุญุงูุฉ ุทูุจูุ ูุฑุฌู ุฅุฑุณุงู ุฑูู ุงูุทูุจ ุงููููู ูู 6-8 ุฃุฑูุงู.\nุณุชุฌุฏู ูู ุฑุณุงูุฉ ุชุฃููุฏ ุงูุทูุจ ุฃู ูู ุตูุญุฉ 'ุทูุจุงุชู' ุจุญุณุงุจู."
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ณ ุงูุฏูุน
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "payment_methods": {
        "keywords": ["ุทุฑู ุงูุฏูุน", "ููู ุงุฏูุน", "ูุณุงุฆู ุงูุฏูุน", "ุงูุฏูุน ุงูุฅููุชุฑููู", "ูููุณ ูุงุด", "ุงูุฏูุน"],
        "answer": "๐ณ ุทุฑู ุงูุฏูุน ุงููุชุงุญุฉ:\nโข ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู (ูุงุด)\nโข ุงูุชุญููู ุงูุจููู\nโข ูุฑููู\nโข ูููุณู\nโข ูู ูุงุด"
    },
    "payment_issue": {
        "keywords": ["ูุดููุฉ ูู ุงูุฏูุน", "ุงูุฏูุน ูุดู", "ูุง ุชู ุงูุฏูุน", "ุฎุตู ูุฑุชูู", "ุงุณุชุฑุฌุงุน ุงููุจูุบ"],
        "answer": f"ูุฃุณู ููุฐุง ุงูุฅุฒุนุงุฌ! ๐\nูููุดุงูู ุงููุงููุฉุ ุชูุงุตู ููุฑูุง ูุน ุฎุฏูุฉ ุงูุนููุงุก:\n{CUSTOMER_SERVICE}\nูุฌูุฒ ุฑูู ุงูุทูุจ ูุฅุซุจุงุช ุงูุฏูุน."
    },
    "installments": {
        "keywords": ["ุชูุณูุท", "ูุณุท", "ุฏูุนุงุช", "ุงูุณุงุท", "ุชุงุจู", "ุชูุงุฑุง"],
        "answer": "๐ ุญุงูููุง ูุง ุชุชููุฑ ุฎุฏูุฉ ุงูุชูุณูุท.\nููู ููุฏู ุนุฑูุถ ูุฎุตููุงุช ูููุฒุฉ ุจุดูู ุฏูุฑู!\nุชุงุจุนูุง ุนูู ูุณุงุฆู ุงูุชูุงุตู ููุจูุงุก ุนูู ุงุทูุงุน."
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # โฉ๏ธ ุงูุฅุฑุฌุงุน ูุงูุงุณุชุจุฏุงู
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "return_policy": {
        "keywords": ["ุณูุงุณุฉ ุงูุฅุฑุฌุงุน", "ุงุฑุฌุงุน", "ุงุณุชุฑุฌุงุน", "ุงุฑุฌุน ุงูููุชุฌ", "ูุง ุนุฌุจูู", "ุงูุฅุฑุฌุงุน"],
        "answer": "โฉ๏ธ ุณูุงุณุฉ ุงูุฅุฑุฌุงุน:\nโข ููููู ุงูุฅุฑุฌุงุน ุฎูุงู 7 ุฃูุงู ูู ุงูุงุณุชูุงู\nโข ุงูููุชุฌ ูุฌุจ ุฃู ูููู ุจุญุงูุชู ุงูุฃุตููุฉ ูุน ุงูุนูุจุฉ\nโข ุจุนุถ ุงูููุชุฌุงุช ุบูุฑ ูุงุจูุฉ ููุฅุฑุฌุงุน (ุณูุงุนุงุชุ ุดูุงุญู ููุชูุญุฉ)"
    },
    "exchange": {
        "keywords": ["ุงุณุชุจุฏุงู", "ุชุจุฏูู", "ุบูุฑ ุงูููุชุฌ", "ุจุฏู", "ููุงุณ ุบูุท", "ููู ุบูุท"],
        "answer": "๐ ููุงุณุชุจุฏุงู:\nโข ูุชุงุญ ุฎูุงู 7 ุฃูุงู ูู ุงูุงุณุชูุงู\nโข ูุฌุจ ุฃู ูููู ุงูููุชุฌ ุจุญุงูุชู ุงูุฃุตููุฉ\nโข ุชูุงุตู ูุนูุง ูุชุฑุชูุจ ุงูุงุณุชุจุฏุงู ูุณูุชููู ุจุงูุดุญู!"
    },
    "refund": {
        "keywords": ["ุงุณุชุฑุฏุงุฏ", "ุชุฑุฌูุน ุงููููุณ", "ุฑุฏ ุงููุจูุบ", "ูููุณู", "ุงููุจูุบ"],
        "answer": "๐ฐ ุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ:\nโข ูุชู ุฑุฏ ุงููุจูุบ ุฎูุงู 5-7 ุฃูุงู ุนูู\nโข ุจููุณ ุทุฑููุฉ ุงูุฏูุน ุงูุฃุตููุฉ\nโข ููุฏูุน ุนูุฏ ุงูุงุณุชูุงู: ุชุญููู ุจููู ุฃู ูุญูุธุฉ ุฅููุชุฑูููุฉ"
    },
    "damaged_product": {
        "keywords": ["ููุชุฌ ุชุงูู", "ููุณูุฑ", "ุฎุฑุจุงู", "ูุนุทู", "ูุง ูุนูู", "ูุง ูุดุชุบู", "ููู ุนูุจ"],
        "answer": f"๐ ูุฃุณู ุฌุฏูุง ูุฐูู!\nุฃุฑุณู ููุง:\nโข ุฑูู ุงูุทูุจ\nโข ุตูุฑ ููููุชุฌ ุงูุชุงูู\nโข ูุตู ุงููุดููุฉ\n\nูุณูููู ุจุงุณุชุจุฏุงูู ุฃู ุฑุฏ ุงููุจูุบ.\n{CUSTOMER_SERVICE}"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ก๏ธ ุงูุถูุงู
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "warranty": {
        "keywords": ["ุถูุงู", "ููุงูุฉ", "ูุถููู", "ูุชุฑุฉ ุงูุถูุงู", "ุงูููุงูุฉ"],
        "answer": "๐ก๏ธ ุณูุงุณุฉ ุงูุถูุงู:\nโข ุงูููุงุชู: ุถูุงู ุณูุฉ ูุงููุฉ\nโข ุงูุฅูุณุณูุงุฑุงุช: 3-6 ุฃุดูุฑ\nโข ุงูุฃุฌูุฒุฉ ุงูุฅููุชุฑูููุฉ: 6-12 ุดูุฑ\n\nุงูุถูุงู ูุบุทู ุนููุจ ุงูุชุตููุน ููุท."
    },
    "warranty_claim": {
        "keywords": ["ุงุทูุจ ุงูุถูุงู", "ุชูุนูู ุงูุถูุงู", "ุตูุงูุฉ", "ุงุตูุงุญ"],
        "answer": f"๐ง ูุทูุจ ุงูุถูุงู:\n1๏ธโฃ ุชุฃูุฏ ูู ูุฌูุฏ ุงููุงุชูุฑุฉ\n2๏ธโฃ ุชูุงุตู ูุนูุง ุจุฑูู ุงูุทูุจ\n3๏ธโฃ ูุตู ุงููุดููุฉ\n\nุณูุฑุชุจ ุงุณุชูุงู ุงูููุชุฌ ูุฅุตูุงุญู ุฃู ุงุณุชุจุฏุงูู.\n{CUSTOMER_SERVICE}"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ค ุงูุญุณุงุจ
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "create_account": {
        "keywords": ["ุงูุดุงุก ุญุณุงุจ", "ุชุณุฌูู", "ุงุณุฌู", "ูุชุญ ุญุณุงุจ", "ุนูู ุญุณุงุจ", "ุงูุญุณุงุจ"],
        "answer": "๐ค ูุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ:\n1๏ธโฃ ุงุฐูุจ ูููููุน ุฃู ุงูุชุทุจูู\n2๏ธโฃ ุงุถุบุท 'ุชุณุฌูู'\n3๏ธโฃ ุฃุฏุฎู ุจูุงูุงุชู (ุงูุงุณูุ ุงูุฌูุงูุ ูููุฉ ุงูุณุฑ)\n\nููููู ุฃูุถูุง ุงูุดุฑุงุก ูุถูู ุจุฏูู ุญุณุงุจ!"
    },
    "forgot_password": {
        "keywords": ["ูุณูุช ูููุฉ ุงูุณุฑ", "ูุณูุช ุงูุจุงุณูุฑุฏ", "ุงุณุชุนุงุฏุฉ ูููุฉ ุงูุณุฑ", "ูุง ุงูุฏุฑ ุงุฏุฎู"],
        "answer": "๐ ูุงุณุชุนุงุฏุฉ ูููุฉ ุงูุณุฑ:\n1๏ธโฃ ุงุถุบุท 'ูุณูุช ูููุฉ ุงูุณุฑ'\n2๏ธโฃ ุฃุฏุฎู ุฑูู ุงูุฌูุงู ุฃู ุงูุฅูููู\n3๏ธโฃ ุณุชุตูู ุฑุณุงูุฉ ุจููุฏ ุงูุชุญูู\n4๏ธโฃ ุฃูุดุฆ ูููุฉ ุณุฑ ุฌุฏูุฏุฉ"
    },
    "update_info": {
        "keywords": ["ุชุญุฏูุซ ุงูุจูุงูุงุช", "ุชุบููุฑ ุงูุนููุงู", "ุชุบููุฑ ุงูุฑูู", "ุนููุงู ุฌุฏูุฏ"],
        "answer": "๐ ูุชุญุฏูุซ ุจูุงูุงุชู:\n1๏ธโฃ ุงุฏุฎู ุญุณุงุจู\n2๏ธโฃ ุงุฐูุจ ุฅูู 'ุงูุฅุนุฏุงุฏุงุช' ุฃู 'ูุนูููุงุชู'\n3๏ธโฃ ุนุฏูู ุงูุจูุงูุงุช ูุงุญูุธ ุงูุชุบููุฑุงุช"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ ุงูุนุฑูุถ ูุงูุฎุตููุงุช
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "offers": {
        "keywords": ["ุนุฑูุถ", "ุฎุตู", "ุชุฎููุถ", "ููุจูู", "ููุฏ ุฎุตู", "ุจุฑููู", "ุงูุนุฑูุถ"],
        "answer": "๐ ุนุฑูุถ TechZone ุชูู ุฒูู:\nโข ุฎุตู 10% ููุทูุจ ุงูุฃูู ุจููุฏ: WELCOME10\nโข ุดุญู ูุฌุงูู ููุทูุจุงุช ููู 50,000 ุฑูุงู\nโข ุนุฑูุถ ุฃุณุจูุนูุฉ ุนูู ุงูููุชุฌุงุช ุงููููุฒุฉ\n\nุชุงุจุนูุง ููุนุฑูุฉ ุฃุญุฏุซ ุงูุนุฑูุถ!"
    },
    "how_to_use_coupon": {
        "keywords": ["ููู ุงุณุชุฎุฏู ุงูููุจูู", "ุงูู ุงูุชุจ ุงูููุฏ", "ุชูุนูู ุงูููุจูู"],
        "answer": "๐ท๏ธ ูุงุณุชุฎุฏุงู ููุฏ ุงูุฎุตู:\n1๏ธโฃ ุฃุถู ุงูููุชุฌุงุช ููุณูุฉ\n2๏ธโฃ ูู ุตูุญุฉ ุงูุฏูุนุ ุงุจุญุซ ุนู 'ููุฏ ุงูุฎุตู'\n3๏ธโฃ ุฃุฏุฎู ุงูููุฏ ูุงุถุบุท 'ุชุทุจูู'\n4๏ธโฃ ุณูุธูุฑ ุงูุฎุตู ูู ุงููุฌููุน"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ฑ ุงูููุชุฌุงุช
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "product_availability": {
        "keywords": ["ูุชููุฑ", "ููุฌูุฏ", "ูู ุงููุฎุฒูู", "ููุฐ", "ุบูุฑ ูุชููุฑ"],
        "answer": "๐ฆ ููุชุญูู ูู ุชููุฑ ููุชุฌ:\nโข ุงุฐูุจ ูุตูุญุฉ ุงูููุชุฌ\nโข ุฅุฐุง ูุงู ูุชููุฑูุง ุณูุธูุฑ ุฒุฑ 'ุฃุถู ููุณูุฉ'\nโข ุฅุฐุง ููุฐ ููููู ุชูุนูู 'ุฃุจูุบูู ุนูุฏ ุงูุชููุฑ'\n\nุฃุฑุณู ูู ุงุณู ุงูููุชุฌ ูุณุฃุชุญูู ูู!"
    },
    "product_original": {
        "keywords": ["ุงุตูู", "ุชูููุฏ", "ูุงู ููุจู", "ุงูุฑูุฌูุงู"],
        "answer": "โ ุฌููุน ููุชุฌุงุช TechZone ุชูู ุฒูู ุฃุตููุฉ 100%!\nโข ูุณุชูุฑุฏ ูู ุงููููุงุก ุงููุนุชูุฏูู\nโข ูู ููุชุฌ ูุฃุชู ูุน ุถูุงู ุฑุณูู\nโข ูุงุชูุฑุฉ ุถุฑูุจูุฉ ููู ุทูุจ"
    },
    "product_specs": {
        "keywords": ["ููุงุตูุงุช", "ุชูุงุตูู", "ุญุฌู", "ููู", "ุงููุงู"],
        "answer": "๐ ููุงุทูุงุน ุนูู ุงูููุงุตูุงุช:\nโข ุงูุชุญ ุตูุญุฉ ุงูููุชุฌ\nโข ูุฑุฑ ููุฃุณูู ููุณู 'ุงูููุงุตูุงุช'\nโข ุณุชุฌุฏ ูู ุงูุชูุงุตูู ุงูุชูููุฉ ูุงูุฃุจุนุงุฏ ูุงูุฃููุงู\n\nุฃุฑุณู ูู ุงุณู ุงูููุชุฌ ูุณุฃุณุงุนุฏู!"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ ุฎุฏูุฉ ุงูุนููุงุก
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "contact": {
        "keywords": ["ุฎุฏูุฉ ุงูุนููุงุก", "ุงููู", "ุงุชูุงุตู", "ุฑูู ุงูุฏุนู", "ุชูุงุตู ูุนูู", "ุฑูู"],
        "answer": f"๐ ุชูุงุตู ูุน TechZone ุชูู ุฒูู:\n{CUSTOMER_SERVICE}\n๐ฌ ูุงุชุณุงุจ: +967 716963404\n๐ง  techzone@net.ye\njabreel160@gmail.com\nโฐ ูููููุง ูู 9 ุตุจุงุญูุง ุฅูู 9 ูุณุงุกู"
    },
    "complaint": {
        "keywords": ["ุดููู", "ุงุดุชูู", "ูุณุชุงุก", "ุฒุนูุงู", "ุณูุก", "ุฎุฏูุฉ ุณูุฆุฉ", "ุนูุฏู ูุดููุฉ"],
        "answer": f"๐ ูุนุชุฐุฑ ุฌุฏูุง ุนู ุฃู ุชุฌุฑุจุฉ ุณูุจูุฉ!\nุดููุงู ุชูููุง ููุญุฑุต ุนูู ุญููุง ุจุฃุณุฑุน ููุช.\n\nุฃุฑุณู ุชูุงุตูู ุงููุดููุฉ ูุฑูู ุงูุทูุจุ ุฃู ุชูุงุตู ูุจุงุดุฑุฉ:\n{CUSTOMER_SERVICE}"
    },
    "working_hours": {
        "keywords": ["ุงููุงุช ุงูุนูู", "ูุชู ุชูุชุญูู", "ุณุงุนุงุช ุงูุฏูุงู", "ููุงุนูุฏ"],
        "answer": "โฐ ุฃููุงุช ุงูุนูู:\nูููููุง ูู 9 ุตุจุงุญูุง ุฅูู 9 ูุณุงุกู\nุงููุชุฌุฑ ุงูุฅููุชุฑููู ูุชุงุญ 24 ุณุงุนุฉ!\nุฎุฏูุฉ ุงูุนููุงุก ูุชุงุญุฉ ุฎูุงู ุฃููุงุช ุงูุฏูุงู."
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ ุงูุทูุจ
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "how_to_order": {
        "keywords": ["ููู ุงุทูุจ", "ุทุฑููุฉ ุงูุทูุจ", "ุงุดุชุฑู", "ููู ุงุดุชุฑู"],
        "answer": "๐ ุทุฑููุฉ ุงูุทูุจ ูู TechZone ุชูู ุฒูู:\n1๏ธโฃ ุงุฎุชุฑ ุงูููุชุฌ ูุงุถุบุท 'ุฃุถู ููุณูุฉ'\n2๏ธโฃ ุงุฐูุจ ููุณูุฉ ูุงุถุบุท 'ุฅุชูุงู ุงูุทูุจ'\n3๏ธโฃ ุฃุฏุฎู ุนููุงู ุงูุชูุตูู\n4๏ธโฃ ุงุฎุชุฑ ุทุฑููุฉ ุงูุฏูุน\n5๏ธโฃ ุฃูุฏ ุงูุทูุจ ูุงูุชุธุฑ ุงูุชูุตูู! ๐ฆ"
    },
    "cancel_order": {
        "keywords": ["ุงูุบุงุก ุงูุทูุจ", "ุงูุบู ุงูุทูุจ", "ูุง ุงุจู ุงูุทูุจ", "ููุณู"],
        "answer": f"โ ูุฅูุบุงุก ุงูุทูุจ:\nโข ุฅุฐุง ูู ููุดุญู ุจุนุฏ: ูููู ุงูุฅูุบุงุก ููุฑูุง\nโข ุฅุฐุง ุชู ุงูุดุญู: ุงูุชุธุฑ ุงูุงุณุชูุงู ุซู ุฃุฑุฌุนู\n\nุชูุงุตู ูุนูุง ุณุฑูุนูุง:\n{CUSTOMER_SERVICE}"
    },
    "modify_order": {
        "keywords": ["ุชุนุฏูู ุงูุทูุจ", "ุบูุฑ ุงูุนููุงู", "ุงุถูู ููุชุฌ", "ุบูุฑ ุงููููุฉ"],
        "answer": f"๐ ูุชุนุฏูู ุงูุทูุจ:\nโข ุงูุชุนุฏูู ูููู ููุท ูุจู ุงูุดุญู\nโข ุชูุงุตู ูุนูุง ููุฑูุง ุจุฑูู ุงูุทูุจ ูุงูุชุนุฏูู ุงููุทููุจ\n{CUSTOMER_SERVICE}"
    },

    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    # ๐ฑ ุงูุชุทุจูู
    # โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    "app_download": {
        "keywords": ["ุชุทุจูู", "ุงุจูููุดู", "ุชุญููู ุงูุชุทุจูู", "ุงูุงูุฏุฑููุฏ", "ุงูุงูููู"],
        "answer": "๐ฑ ุญููู ุชุทุจูู TechZone ุชูู ุฒูู:\nโข ุฃูุฏุฑููุฏ: Google Play Store\nโข ุขูููู: App Store\n\nุงุจุญุซ ุนู 'TechZone ุชูู ุฒูู' ูุญููู ุงูุชุทุจูู ูุฌุงููุง!"
    },
}

def detect_intent(user_text: str):
    text = user_text.lower()
    for intent, data in INTENTS.items():
        for kw in data["keywords"]:
            if kw in text:
                return data["answer"]
    return None

# =====================
# FastAPI App
# =====================
app = FastAPI(title="TechZone Chat API")

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ูุงุญููุง ููููุฏูุง
    allow_methods=["*"],
    allow_headers=["*"],
)

# =====================
# OpenAI Client
# =====================
import os
from dotenv import load_dotenv

load_dotenv()
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

SYSTEM_PROMPT = """
ุฃูุช ูุณุงุนุฏ ุฐูู ุฑุณูู ููุชุฌุฑ ุฅููุชุฑููู ูุชุฎุตุต ูู ุงูุชูููุฉ ุงุณูู (TechZone ุชูู ุฒูู).

ููุงูู:
- ูุณุงุนุฏุฉ ุงูุนููุงุก ูู ุฃุณุฆูุฉ ุงูุดุญูุ ุงูุทูุจุงุชุ ุงูุฏูุนุ ุงูุฅุฑุฌุงุนุ ุงูุญุณุงุจุ ุงูุนุฑูุถุ ูุงูุดูุงูู.
- ุงูุฑุฏ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุฃุณููุจ ูุฏูุฏ ููููู.
- ุชูุฏูู ุฅุฌุงุจุงุช ูุฎุชุตุฑุฉ ููุงุถุญุฉ ุจุฏูู ุญุดู.
- ุนุฏู ุงุฎุชุฑุงุน ูุนูููุงุช ุฃู ุณูุงุณุงุช ุบูุฑ ูุฐููุฑุฉ.
- ุฅุฐุง ูุงู ุงูุณุคุงู ุบูุฑ ูุงุถุญุ ุงุทูุจ ุชูุถูุญู ุจูุทู.
- ุฅุฐุง ุงุญุชุงุฌ ุงูุนููู ุฏุนููุง ุจุดุฑููุงุ ูุฌููู ูุฎุฏูุฉ ุงูุนููุงุก.

ูุนูููุงุช ุงููุชุฌุฑ:
- ุงุณู ุงููุชุฌุฑ: TechZone ุชูู ุฒูู
- ุงูุชุฎุตุต: ููุชุฌุงุช ุชูููุฉ ุฃุตููุฉ ููุถูููุฉ
- ุจูุฏ ุงูุนูู: ุงูููู
- ูุฏุฉ ุงูุดุญู ุงููุนุชุงุฏุฉ: 24 ุฅูู 48 ุณุงุนุฉ ุนูู
- ุฃููุงุช ุงูุฏุนู: ูููููุง ูู 9 ุตุจุงุญูุง ุฅูู 9 ูุณุงุกู

ุณูุงุณุงุช ุงููุชุฌุฑ:
- ุงูุฅุฑุฌุงุน: ุฎูุงู 7 ุฃูุงู ูู ุงูุงุณุชูุงู
- ุงูุถูุงู: ุณูุฉ ููููุงุชูุ 3-12 ุดูุฑ ููุฅูุณุณูุงุฑุงุช
- ุงูุฏูุน: ูุงุด ุนูุฏ ุงูุงุณุชูุงูุ ุชุญููู ุจูููุ ูุฑูููุ ูููุณูุ ูู ูุงุด

ุฃุณููุจ ุงูุฑุฏ:
- ุงุณุชุฎุฏู ูุบุฉ ูุญุชุฑูุฉ ููุฑูุจุฉ ูู ุงูุนููู.
- ูุง ุชุฐูุฑ ุฃูู ูููุฐุฌ ุฐูุงุก ุงุตุทูุงุนู.
- ูุง ุชูุฑุฑ ุงูุณุคุงู.
- ูุง ุชุณุชุฎุฏู ุฑููุฒ ูุซูุฑุฉ.
- ูุง ุชุนุทู ุฅุฌุงุจุฉ ุทูููุฉ ุฅูุง ุฅุฐุง ุทููุจ ุฐูู.
- ุนูุฏ ุงูุชุญูุฉ: ุฑุญูุจ ุจุงูุนููู ูุนุฑูู ุจููุณู ุจุงุฎุชุตุงุฑ.
- ุนูุฏ ุงูุดููู: ุงุนุชุฐุฑ ุฃูููุง ุซู ุงูุชุฑุญ ุงูุญู ุฃู ุงูุชุตุนูุฏ.
- ุนูุฏ ุนุฏู ุชููุฑ ุฅุฌุงุจุฉ ุฏูููุฉ: ุงุทูุจ ุฑูู ุงูุทูุจ ุฃู ูุฌูู ููุฏุนู.

โ ููู:
ุฅุฐุง ูุงู ุงูุณุคุงู ุฎุงุฑุฌ ูุทุงู ุงููุชุฌุฑ (ุณูุงุณุฉุ ุฏููุ ุตุญุฉุ ููุงุถูุน ุนุงูุฉ):
ุงุนุชุฐุฑ ุจูุทู ููุฌูู ุงูุนููู ุฅูู ุฎุฏูุฉ ุงูุนููุงุก ููุท.

"""

# =====================
# Request Schema
# =====================
class ChatRequest(BaseModel):
    message: str

# =====================
# Routes
# =====================
@app.get("/")
def root():
    return {"status": "Noura Chat API is running"}
'''
@app.post("/chat")
def chat(req: ChatRequest):
    user_msg = req.message

    # (1) ุฑุฏูุฏ ุฌุงูุฒุฉ ุฃููุงู
    rule_reply = rule_based_reply(user_msg)
    if rule_reply:
        return {"answer": rule_reply, "source": "rule"}

    # (2) ุฅุฐุง ูุง ููููุง ุฑุฏ ุฌุงูุฒ โ ูุณุชุฎุฏู GPT
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": user_msg}
        ],
        max_tokens=200,
        temperature=0.2
    )

    return {
        "answer": response.choices[0].message.content,
        "source": "llm"
    }
'''
@app.post("/chat")
def chat(req: ChatRequest):

    # 1๏ธโฃ ูุญุงูู ูุฑุฏ ูู ุงูููุงุนุฏ
    intent_answer = detect_intent(req.message)
    if intent_answer:
        return {
            "answer": intent_answer,
            "source": "rule"
        }

    # 2๏ธโฃ ุฅุฐุง ูุง ููููุงุ ูุฑูุญ ูู GPT
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": req.message}
        ],
        max_tokens=200,
        temperature=0.2
    )

    return {
        "answer": response.choices[0].message.content,
        "source": "llm"
    }



